/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="acrobatContentScriptDisconnectStart",t="acrobatContentScriptDisconnectEnd",i="acrobat-gmail-fte-config";let o,n,r,s,a,c,m,l,p,u,g,h,d,w,f,v,T,b,D,P,C,_;const A=()=>{f&&(n?.addAcrobatTouchPointInTheMessageView(),r?.processForListView(),o?.processForAlreadyShownNativeViewerPrompt()),(v||C)&&m?.addExpressNativeViewerTouchpoint(),T&&l?.addExpressMessageViewTouchpoint(),P&&d?.addTouchPointToComposeBoxPDFAttachment(),b?(g?.addTouchpointToNativeViewerViaMessageView(),p?.addTouchpointToNativeViewerViaListView(),u?.processForAlreadyShownNativeViewerTouchpoint()):D&&u?.processForNativeViewerControlExperiment()},S=new MutationObserver(function(){w?.disconnectBodyObserver?S.disconnect():(S.takeRecords(),chrome?.runtime?.id?A():(a?.removeAllAcrobatTouchPoints(),m?.removeExpressTouchpoints(),u?.removeAllAcrobatNonPdfTouchPoints(),d?.removeAllCompressPDFTouchpoints(),S?.disconnect()))}),E=()=>{if(document?.body)try{const e={childList:!0,subtree:!0};S.observe(document.body,e)}catch(e){}else setTimeout(E,500)},V=()=>{window.addEventListener(t,e=>w.contentScriptDisconnectEnd(e),{signal:w?.eventControllerSignal}),window.addEventListener(e,()=>(e=>{if(!chrome.runtime?.id){const i=e.createStateToTransferToNewContentScript();e.contentScriptDisconnectStart(),S?.disconnect(),window.dispatchEvent(new CustomEvent(t,{detail:{state:i}}))}})(w),{signal:w?.eventControllerSignal})},L=()=>{V(),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new CustomEvent(e)),s.addFontToDocument(w)},F=(e,t,o,n,r)=>{w&&(w.gmailConfig=e,w.iconURL="browser/images/acrobat_dc_appicon_128.png",w.iconURLListView="browser/images/acrobat_dc_trefoil_24_white.svg",w.viewerURLPrefix=chrome.runtime.getURL("viewer.html"),w.expressConfig=t,w.gmailConvertToPdfConfig=o,w.gmailImplicitDefaultViewershipConfig=n,w.gmailCompressPDFConfig=r),f&&(L(),(async()=>{const e=(new Date).getTime();let t={count:0,nextDate:e};t=(await chrome.storage.local.get(i))?.[i]||t;const o=w?.gmailConfig?.fteConfig?.tooltip;((e,t)=>-1!==e?.resetDay&&t>e?.resetDay)(o,e)&&(t.count=0,t.nextDate=e),w.fteToolTip={eligibleFte:{type:""},...t},t={[i]:t},chrome.storage.local.set(t)})(),((e,t)=>{w.isAcrobatDefaultForGmailPDFs=e?.isAcrobatDefaultForSurface||t?.isAcrobatDefaultForSurface})(e,n)),!f&&b&&L()};chrome.runtime.onMessage.addListener(function(e){"acrobatGmailFteStateUpdated"===e.content_op?w.fteToolTip={...w.fteToolTip,...e?.fteState}:"changeDefaultViewershipForSurface"===e.content_op?"gmail"===e?.surfaceId&&chrome.runtime.id&&(e?.isDefault?c?.takeDefaultViewerShip():c?.resetDefaultViewership(),V(),A()):"acrobatTouchPointsDisabled"===e.content_op?e.acrobatShortcutSurfaceId&&"gmail"!==e.acrobatShortcutSurfaceId||(w.gmailConfig.touchPointSettingEnabled=!1,w?.isAcrobatDefaultForGmailPDFs||(f=!1,a?.removeAllAcrobatTouchPoints()),b=!1,u?.removeAllAcrobatNonPdfTouchPoints(),w?.disconnectAcrobatListeners()):"show-implicit-dv-toast"===e.content_op&&h?.shouldShowImplicitDefaultViewerToast("gmail",w)&&h?.showImplicitDefaultViewershipToast("gmail",w?.gmailImplicitDefaultViewershipConfig?.toastMessage)}),(async()=>{const e=chrome.runtime.getURL("content_scripts/gmail/state.js"),t=chrome.runtime.getURL("content_scripts/gmail/native-viewer-touch-point-service.js"),i=chrome.runtime.getURL("content_scripts/gmail/message-view-touch-point-service.js"),f=chrome.runtime.getURL("content_scripts/gmail/list-view-touch-point-service.js"),v=chrome.runtime.getURL("content_scripts/utils/util.js"),T=chrome.runtime.getURL("content_scripts/gmail/util.js"),b=chrome.runtime.getURL("content_scripts/gmail/default-viewership-service.js"),D=chrome.runtime.getURL("content_scripts/express/gmail/image-gmail-touchpoint-service.js"),P=chrome.runtime.getURL("content_scripts/express/gmail/express-gmail-message-view-touchpoint-service.js"),C=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-message-view.js"),_=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-list-view.js"),A=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-native-viewer.js"),S=chrome.runtime.getURL("content_scripts/utils/implicit-toast-service.js"),E=chrome.runtime.getURL("content_scripts/gmail/gmail-compose-attachment-touch-point-service.js");return Promise.all([import(t),import(i),import(f),import(T),import(v),import(b),import(e),import(D),import(P),import(C),import(_),import(A),import(S),import(E)]).then(e=>{o=e[0],n=e[1],r=e[2],a=e[3],s=e[4],c=e[5],w=e[6]?.default,m=e[7],l=e[8],g=e[9],p=e[10],u=e[11],h=e[12],d=e[13]})})().then(()=>{window.location?.search?.includes("acrobatPromotionSource")||Promise.all([chrome.runtime.sendMessage({main_op:"gmail-init"}),chrome.runtime.sendMessage({main_op:"gmail-express-init"}),chrome.runtime.sendMessage({main_op:"gmail-convert-to-pdf-init"}),chrome.runtime.sendMessage({main_op:"gmail-compress-pdf-init"}),chrome.runtime.sendMessage({main_op:"implicit-default-viewership-init",surfaceId:"gmail"})]).then(([e,t,i,o,n])=>{var r;f=((e,t)=>a?.shouldProcessForListView(e,t))(e,n),v=function(e){return e.enableGmailNVExpressMenu}(t),T=function(e){return e.enableGmailMessageViewCTA}(t),b=function(e,t){return a?.shouldProcessForConvertToPDF(e,t)}(i,e),D=function(e){return e?.enableConvertToPdfTouchpointInGmailControl}(i),r=o,P=r?.enableGmailCompressPDFTouchPoint,C=function(e){return e.enableGmailConvertToPdfInImages}(t),_=function(e){return e.enableGmailConvertToPdfInImagesControl}(t),(f||v||T||b||D||P||C||_)&&(function(e,t){t?.enableImplicitDefaultViewershipFeature&&(e.gmailFteToolTipStrings=t.fteToolTipStrings)}(e,n),F(e,t,i,n,o),a?.removeAllAcrobatTouchPoints(),m?.removeExpressTouchpoints(),u?.removeAllAcrobatNonPdfTouchPoints(),d?.removeAllCompressPDFTouchpoints(),h?.shouldShowImplicitDefaultViewerToast("gmail",w)&&setTimeout(()=>{h?.showImplicitDefaultViewershipToast("gmail",w?.gmailImplicitDefaultViewershipConfig?.toastMessage)},1e3),A(),E(),f&&(s?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:PromotionFeature:Enable"),s?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:FTE:Enable")),(b||D)&&s?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:ConvertToPdf:Enable"),C&&s?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:Images:Enable"),_&&s?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:Images:Control:Enable"))})})})();