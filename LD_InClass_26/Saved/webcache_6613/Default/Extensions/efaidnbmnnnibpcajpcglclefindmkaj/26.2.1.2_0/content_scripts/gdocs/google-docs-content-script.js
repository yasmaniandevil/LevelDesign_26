/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(async()=>{let e,t,o=null,n=null;const r="GoogleDocs",c="ConvertToPdf",a="acrobat-convert-to-pdf-touch-point",s={document:{surface:"gdocs_chrome",fileExtension:".docx",exportFormat:"docx",handleTouchPointInteraction:(e,t,o)=>{u(e,t,o)}},spreadsheets:{surface:"gsheets_chrome",fileExtension:".xlsx",exportFormat:"xlsx",handleTouchPointInteraction:(e,t,o)=>{m(e,t,n=>{u(e,t,o,n)})}},presentation:{surface:"gslides_chrome",fileExtension:".pptx",exportFormat:"pptx",handleTouchPointInteraction:(e,t,o)=>{u(e,t,o)}}},i=(e,t={})=>{try{chrome.runtime.sendMessage({main_op:"analytics",analytics:[[e,t]]})}catch(e){}},l=e=>{const{authuser:t}=e.detail;t&&(o=t)},d=()=>{const e=(e=>{try{return new URL(e).searchParams.get("authuser")}catch(t){const o=e.match(/[?&]authuser=([^&]*)/);return o?o[1]:null}})(window.location.href);null!==e?o=e:((()=>{const e=document.createElement("script");e.src=chrome.runtime.getURL("content_scripts/gdocs/google-docs-fetch-interceptor.js"),(document.head||document.documentElement).appendChild(e),e.onload=()=>{e.remove()}})(),document.addEventListener("acrobat-extension-authuser",l))},u=(t,n,a,l={})=>{if("click"===t.type||"mousedown"===t.type||"Enter"===t.key){const t=window.location.href,d=((e,t)=>{const o=new RegExp(`\\/${t}\\/d\\/([a-zA-Z0-9_-]+)`),n=e.match(o);return n?n[1]:null})(t,a);if(d){const u=s[a]?.surface,m=s[a]?.fileExtension,h=s[a]?.exportFormat,p=e?.buildAcrobatPromotionSource(u,"convert_to_pdf");let w;if(null!==o)w=`&authuser=${o}`;else{const e=t.match(/\/u\/(\d+)\//);w=e?`&authuser=${e[1]}`:"&authuser=0"}const f=`https://docs.google.com/${a}/d/${d}/export?format=${h}${w}`;chrome.runtime.sendMessage({main_op:"execute-direct-verb",fileUrl:f,fileName:n+m,viewerURL:chrome.runtime.getURL("viewer.html"),promotionSource:p,verb:"createpdf",clickTimestamp:Date.now(),verbConfig:{orientation:l?.orientation,scale:l?.scale}}),i("DCBrowserExt:DirectVerb:CTA:Clicked",{source:`${r}_${a}`,workflow:c}),window.updateFTEStateWhenGoogleDocsTouchPointClicked&&window.updateFTEStateWhenGoogleDocsTouchPointClicked()}}},m=async(e,t,o)=>{if("click"!==e.type&&("keydown"!==e.type||"Enter"!==e.key))return;const a=await(async()=>{if(n)return n;try{const e=await import(chrome.runtime.getURL("dist/SheetsSettingModal.js"));return n=e.default,n}catch(e){return null}})();a&&(i("DCBrowserExt:DirectVerb:ConvertToPdf:Modal:Opened",{source:`${r}_spreadsheets`,workflow:c}),await a.render({docTitle:t,initialScale:"fit_to_width",initialOrientation:"portrait",onConvert:e=>{o(e)},onClose:()=>{i("DCBrowserExt:DirectVerb:ConvertToPdf:Modal:Closed",{source:`${r}_spreadsheets`,workflow:c})}}))},h=async(t,o)=>{const n=e?.getElementFromParent(t?.selectors?.fileExtension,document),l=n?.textContent||"",d=t?.selectors?.supportedFileExtensions||[];if(document.getElementsByClassName(a)?.length>0||!d.includes(l.trim()))return;const u=e.getElementFromParent(t?.selectors?.touchPointContainer,document),m=e?.getElementFromParent(t?.selectors?.docTitle,document);if(m){const n=document.createElement("div"),l=e?.createAcrobatIconElement("acrobat-icon","browser/images/acrobat_dc_appicon_128.png"),d=(e=>{const t=document.createElement("span");return t.classList.add("acrobat-convert-to-pdf-touch-point-text"),t.textContent=e?.text?.acrobatTouchPointText,t})(t),h=(e=>{const t=document.createElement("div");return t.classList.add("acrobat-convert-to-pdf-touch-point-tooltip"),t.textContent=e?.text?.acrobatTouchPointTooltip,t})(t);n.appendChild(l),n.appendChild(d),n.appendChild(h),n.className=a,n.classList.add(`${a}-${o}`);const p=s[o]?.handleTouchPointInteraction;n.addEventListener("click",e=>p(e,m?.value||"",o)),n.addEventListener("keydown",e=>p(e,m?.value||"",o)),n.setAttribute("tabindex","0");const w=e?.getElementFromParent(t?.selectors?.touchPointSibling,document);u&&w&&(u.insertBefore(n,w),i("DCBrowserExt:DirectVerb:CTA:Shown",{source:`${r}_${o}`,workflow:c}),chrome.runtime.sendMessage({main_op:"google_docs_touch_point_added"}))}};(async()=>{const o=window.location.pathname.split("/")?.length>1?window.location.pathname.split("/")[1]:null,n=await chrome.runtime.sendMessage({main_op:"google_docs_init",docType:o});n?.validPaths?.includes(o)&&n?.enableConvertToPDFTouchPoint&&(async()=>{[e]=await Promise.all([import(chrome.runtime.getURL("content_scripts/utils/util.js"))])})().then(()=>{d(),i("DCBrowserExt:DirectVerb:CTA:Enabled",{source:`${r}_${o}`,workflow:c}),document.addEventListener("acrobat-extension-authuser",l),e?.addFontToDocument({adobeCleanFontAdded:!1}),((e,o)=>{t=new MutationObserver(()=>{h(e,o)}),t.observe(document.body,{childList:!0,subtree:!0})})(n,o)})})()})();